from flask import Flask, render_template, request, jsonify
from notifypy import Notify
import threading
import time
import os

app = Flask(__name__)

# Initial values
drinked_water = 0
target_intake = 3200  # Default target intake
send_notifications = False  # Flag to control notification sending

# Create a Notify object
notification = Notify()

@app.route('/')
def index():
    return render_template('index.html', drinked_water=drinked_water, target_intake=target_intake)

@app.route('/update_intake', methods=['POST'])
def update_intake():
    global drinked_water, target_intake, send_notifications
    intake = int(request.json['intake'])
    drinked_water += intake
    
    # Check if target intake is reached
    if drinked_water >= target_intake:
        send_notifications = False  # Stop notifications
    
    return jsonify({'status': 'success', 'water_intake': drinked_water, 'target_intake': target_intake})

@app.route('/update_target', methods=['POST'])
def update_target():
    global target_intake
    target_intake = int(request.json['target_intake'])
    return jsonify({'status': 'success', 'target_intake': target_intake})

def send_reminder_notifications(name, interval):
    global send_notifications
    while send_notifications:
        # Send notification
        notification.title = 'Water Reminder'
        notification.message = f"Hey, don't forget to drink water!"
        icon_path = os.path.join( r"data:image/jpeg;base64,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")
        
        if os.path.exists(icon_path):
            notification.icon = icon_path
        else:
            print(f"Icon file {icon_path} does not exist")
            notification.icon = None  # Or set a default icon
        
    
        print(f"Notification sent with icon: {icon_path}")

        # Wait for the given interval (converted from minutes to seconds)
        time.sleep(interval * 60)
        notification.send()

@app.route('/set_reminder', methods=['POST'])
def set_reminder():
    global send_notifications
    send_notifications = True
    name = 'praisy'
    interval = 1  # Interval in minutes

    # Start the reminder notifications in a separate thread
    reminder_thread = threading.Thread(target=send_reminder_notifications, args=(name, interval))
    reminder_thread.start()

    return jsonify({'status': 'success'})

if __name__ == '__main__':
    app.run()
